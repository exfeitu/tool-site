---
import Layout from '../../layouts/Layout.astro';

const config = {
  slug: 'json-diff',
  title: 'JSON Diff - Compare JSON Online Free',
  description: 'Compare two JSON objects online for free. Find differences between JSON files instantly. Highlights added, removed, and modified values. No signup required.',
  keywords: 'json diff, compare json, json compare, json difference, compare json online, json diff tool, json comparison',
};

const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How to compare two JSON objects?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Paste your first JSON in the left box and second JSON in the right box, then click 'Compare JSON' to see the differences."
      }
    },
    {
      "@type": "Question",
      "name": "What does JSON diff show?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "JSON diff shows added fields (green), removed fields (red), and modified values (yellow) between two JSON objects."
      }
    }
  ]
};
---

<Layout title={config.title} description={config.description} keywords={config.keywords}>
  <script type="application/ld+json">{}
  </script>
  <div class="max-w-6xl mx-auto px-4">
    <div class="mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-3">JSON Diff</h1>
      <p class="text-lg text-gray-600">
        Compare two JSON objects and find differences instantly. Highlights changes, additions, and deletions.
      </p>
    </div>

    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div>
          <div class="block text-sm font-semibold text-gray-700 mb-2">
            JSON 1 (Original):
          </div>
          <textarea
            id="json-left"
            class="w-full h-80 p-4 border-2 border-gray-300 rounded-lg font-mono text-sm focus:border-blue-500 focus:outline-none resize-y"
            placeholder='{"name":"John","age":30}'
          ></textarea>
        </div>
        <div>
          <div class="block text-sm font-semibold text-gray-700 mb-2">
            JSON 2 (Modified):
          </div>
          <textarea
            id="json-right"
            class="w-full h-80 p-4 border-2 border-gray-300 rounded-lg font-mono text-sm focus:border-blue-500 focus:outline-none resize-y"
            placeholder='{"name":"Jane","age":30,"city":"NYC"}'
          ></textarea>
        </div>
      </div>

      <div class="flex gap-3 mb-6">
        <button
          id="compare-btn"
          class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors shadow-md hover:bg-blue-700"
        >
          Compare JSON
        </button>
        <button
          id="clear-btn"
          class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
        >
          Clear
        </button>
      </div>

      <div id="diff-output" class="hidden">
        <div class="block text-sm font-semibold text-gray-700 mb-2">
          Differences:
        </div>
        <div class="border-2 border-gray-300 rounded-lg p-4 bg-gray-50 max-h-96 overflow-auto">
          <div id="diff-content"></div>
        </div>
      </div>

      <div id="no-diff" class="hidden p-4 bg-green-50 border-2 border-green-200 rounded-lg text-green-700">
        <div class="flex items-center gap-2">
          <span class="text-2xl">OK</span>
          <div>
            <div class="font-bold">No Differences!</div>
            <div class="text-sm">Both JSON objects are identical.</div>
          </div>
        </div>
      </div>

      <div id="error-output" class="hidden mt-4 p-4 bg-red-50 border-2 border-red-200 rounded-lg text-red-700"></div>
    </div>

    <div class="bg-blue-50 rounded-lg p-6 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">
        Legend
      </h2>
      <div class="space-y-2">
        <div class="flex items-center gap-2">
          <span class="bg-green-200 text-green-800 px-3 py-1 rounded font-semibold">+ Added</span>
          <span class="text-gray-600">Fields that exist in JSON 2 but not in JSON 1</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="bg-red-200 text-red-800 px-3 py-1 rounded font-semibold">- Removed</span>
          <span class="text-gray-600">Fields that exist in JSON 1 but not in JSON 2</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="bg-yellow-200 text-yellow-800 px-3 py-1 rounded font-semibold">~ Modified</span>
          <span class="text-gray-600">Fields with different values</span>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Example</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-semibold text-gray-900 mb-2">JSON 1:</h3>
          <pre class="bg-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code>{`{"name":"John","age":30,"city":"NYC"}`}</code></pre>
        </div>
        <div>
          <h3 class="font-semibold text-gray-900 mb-2">JSON 2:</h3>
          <pre class="bg-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code>{`{"name":"Jane","age":30,"country":"USA"}`}</code></pre>
        </div>
      </div>
      <div class="mt-4">
        <h3 class="font-semibold text-gray-900 mb-2">Differences:</h3>
        <div class="space-y-1 text-sm">
          <div class="bg-yellow-100 p-2 rounded">~ name: "John" -> "Jane"</div>
          <div class="bg-red-100 p-2 rounded">- city: "NYC"</div>
          <div class="bg-green-100 p-2 rounded">+ country: "USA"</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">FAQ</h2>
      <div class="space-y-4">
        <div>
          <h3 class="font-semibold text-gray-900 mb-1">How to compare two JSON objects?</h3>
          <p class="text-gray-600">
            Paste your first JSON in the left box and second JSON in the right box, then click 'Compare JSON' to see the differences.
          </p>
        </div>
        <div>
          <h3 class="font-semibold text-gray-900 mb-1">What does JSON diff show?</h3>
          <p class="text-gray-600">
            JSON diff shows added fields (green), removed fields (red), and modified values (yellow) between two JSON objects.
          </p>
        </div>
        <div>
          <h3 class="font-semibold text-gray-900 mb-1">Can I compare nested JSON?</h3>
          <p class="text-gray-600">
            Yes! This tool supports nested JSON objects and arrays, showing differences at all levels.
          </p>
        </div>
      </div>
    </div>

    <div class="bg-gray-100 rounded-lg p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-3">Related Tools</h2>
      <div class="flex gap-3 flex-wrap">
        <a href="/tools/json-beautifier" class="text-blue-600 hover:text-blue-800 font-medium">JSON Beautifier</a>
        <span class="text-gray-300">•</span>
        <a href="/tools/json-validator" class="text-blue-600 hover:text-blue-800 font-medium">JSON Validator</a>
        <span class="text-gray-300">•</span>
        <a href="/tools/json-to-csv" class="text-blue-600 hover:text-blue-800 font-medium">JSON to CSV</a>
      </div>
    </div>
  </div>

  <script type="module">
    const compareBtn = document.getElementById('compare-btn');
    const clearBtn = document.getElementById('clear-btn');
    const jsonLeft = document.getElementById('json-left');
    const jsonRight = document.getElementById('json-right');
    const diffOutput = document.getElementById('diff-output');
    const diffContent = document.getElementById('diff-content');
    const noDiff = document.getElementById('no-diff');
    const errorOutput = document.getElementById('error-output');

    function compareJSON(obj1, obj2, path = '') {
      const diffs = [];
      const keys1 = Object.keys(obj1 || {});
      const keys2 = Object.keys(obj2 || {});
      const allKeys = new Set([...keys1, ...keys2]);

      allKeys.forEach(key => {
        const currentPath = path ? `${path}.${key}` : key;
        const val1 = obj1 && obj1[key];
        const val2 = obj2 && obj2[key];

        if (!(key in obj1)) {
          diffs.push({ type: 'added', path: currentPath, value: val2 });
        } else if (!(key in obj2)) {
          diffs.push({ type: 'removed', path: currentPath, value: val1 });
        } else if (typeof val1 === 'object' && typeof val2 === 'object' && val1 !== null && val2 !== null) {
          diffs.push(...compareJSON(val1, val2, currentPath));
        } else if (val1 !== val2) {
          diffs.push({ type: 'modified', path: currentPath, oldValue: val1, newValue: val2 });
        }
      });

      return diffs;
    }

    if (compareBtn) {
      compareBtn.addEventListener('click', () => {
        const left = jsonLeft.value.trim();
        const right = jsonRight.value.trim();

        if (!left || !right) {
          showError('Please paste JSON in both boxes');
          return;
        }

        try {
          const obj1 = JSON.parse(left);
          const obj2 = JSON.parse(right);

          const diffs = compareJSON(obj1, obj2);

          if (diffs.length === 0) {
            noDiff.classList.remove('hidden');
            diffOutput.classList.add('hidden');
            errorOutput.classList.add('hidden');
          } else {
            let html = '<div class="space-y-2">';
            diffs.forEach(diff => {
              if (diff.type === 'added') {
                html += `<div class="bg-green-100 border-l-4 border-green-500 p-3 rounded">
                  <span class="font-semibold text-green-800">+ ${diff.path}</span>
                  <div class="text-sm text-gray-700 ml-4">Added: ${JSON.stringify(diff.value)}</div>
                </div>`;
              } else if (diff.type === 'removed') {
                html += `<div class="bg-red-100 border-l-4 border-red-500 p-3 rounded">
                  <span class="font-semibold text-red-800">- ${diff.path}</span>
                  <div class="text-sm text-gray-700 ml-4">Removed: ${JSON.stringify(diff.value)}</div>
                </div>`;
              } else if (diff.type === 'modified') {
                html += `<div class="bg-yellow-100 border-l-4 border-yellow-500 p-3 rounded">
                  <span class="font-semibold text-yellow-800">~ ${diff.path}</span>
                  <div class="text-sm text-gray-700 ml-4">
                    Old: ${JSON.stringify(diff.oldValue)}<br/>
                    New: ${JSON.stringify(diff.newValue)}
                  </div>
                </div>`;
              }
            });
            html += '</div>';

            diffContent.innerHTML = html;
            diffOutput.classList.remove('hidden');
            noDiff.classList.add('hidden');
            errorOutput.classList.add('hidden');
          }
        } catch (e) {
          showError(`Invalid JSON: ${e.message}`);
        }
      });
    }

    if (clearBtn) {
      clearBtn.addEventListener('click', () => {
        jsonLeft.value = '';
        jsonRight.value = '';
        diffOutput.classList.add('hidden');
        noDiff.classList.add('hidden');
        errorOutput.classList.add('hidden');
      });
    }

    function showError(message) {
      errorOutput.textContent = message;
      errorOutput.classList.remove('hidden');
      diffOutput.classList.add('hidden');
      noDiff.classList.add('hidden');
    }
  </script>
</Layout>


